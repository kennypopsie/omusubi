<div class="post-list">
  <a class="post" href="<%= edit_channel_path(@channel) %>">
    <div class="header">
      <h2 class="title"><%= @channel.title %></h2>
      <p class="timestamp"><%= @channel.created_at.strftime("%Y/%m/%d") %></p>
    </div>
  </a>
</div>

<div class="comment-form-container">
  <div class="comment">
    <!--model: @contentはinput actionがcommentになる。commentにデータが送られる。-->
    <!--createa_comment_pathの後の@channel変数はurlにchannelのidを付与するため？-->
    <%= form_with(url: create_comment_path(@channel), model: @comment, local: true, method: :post) do |f| %>
      <div class="form">
        <div class="textarea">
          <%= f.label "コメント", class: 'form-label' %>
          <%= f.text_field :content, class: 'form-control' %>
        </div>
        <div class="button-group">
          <%= f.submit '送信', class: 'btn btn-primary' %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<div class="comment-list">
  <% @comments.each do |comment| %>
    <div class="comment">
      <div class="body">
        <p class="content"><%= comment.content %></p>
      </div>
      <div class="comment-detail">
        <p class="timestamp"><%= comment.created_at.strftime("%Y/%m/%d %H:%M") %></p>
        <p class="username">投稿者 <%= comment.user.name %></p>
      </div>
      <div class="comment-edit">
      <%= link_to '削除', destroy_comment_path(comment), method: :delete, data: { confirm: '本当に削除しますか？' }, class: "destroy" %>

      <!-- 編集ボタン -->
      <button class="edit js-modal-button" data-target="#modal<%= comment.id %>">編集</button>
      
      <!-- モーダル -->
      <div id="modal<%= comment.id %>" class="layer js-modal">
        <div class="modal">
          <div class="modal__inner">
            <div class="modal__button-wrap">
              <button class="close-button js-close-button">
                <span></span>
                <span></span>
              </button>
            </div>
            <div class="modal__contents">
              <div class="modal__content">
                  <%= form_with(url: create_reply_path(comment.id), local: true, method: :post, html: { class: 'post-form' }) do |f| %>
                  
                  
                  <% end %>
                
                  <%= form_with(url: update_comment_path(comment.id), local: true, method: :patch, html: { class: 'post-form' }) do |f| %>

                    <div class="form-group">
                      <%= f.label "コメントを編集", class: 'form-label' %>
                      <%= f.text_area :content, value: comment.content, class: 'form-control' %>
                    </div>
                    <div class="button-group">
                      <%= link_to '削除', destroy_comment_path(comment), method: :delete, data: { confirm: '本当に削除しますか？' }, class: "btn btn-danger" %>
                      <%= f.submit '更新', class: 'btn btn-primary' %>
                    </div>

                  <% end %>

                       <%= form_with(url: create_reply_path, model: @reply, local: true, method: :post) do |f| %>
                        <div class="form">
                          <div class="textarea">
                            <%= f.label "返信", class: 'form-label' %>
                            <%= f.hidden_field :comment_id, value: comment.id %>
                            <%= f.text_field :content, class: 'form-control' %>
                          </div>
                          <div class="button-group">
                            <%= f.submit '送信', class: 'btn btn-primary' %>
                          </div>
                        </div>
                    <% end %>
                  

              </div>
             </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    
  <% end %>
         <% @replies.each do |reply| %> 
         <p><%= reply.content %> </p>

         <% end %>
 <%= link_to '一覧に戻る', index_channel_path %>
</div>